<!DOCTYPE html>
<html>

<head>
    <title>Smurfs</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link href="/css/application_edit.css" rel="stylesheet">
    <script src="/js/info.js"></script>
</head>

<body>
    <div class="page_header">
        <ul>
            <div class="logo">
                <h3><a href="info.html">Smurfs</a></h3>
            </div>
            <div class="navbar">
                <ul class="nav navbar-nav navbar-right pull-right">
                    <li class="dropdown">
                        <a href="#" title="4 support tickets" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="glyphicon glyphicon-globe"></i>
                            <span class="count">4</span>
                        </a>
                        <ul id="support-menu" class="dropdown-menu support" role="menu">
                            <li role="presentation">
                                <a href="#" class="support-ticket">
                                    <div class="picture">
                                        <span class="label label-important"><i class="fa fa-bell-o"></i></span>
                                    </div>
                                    <div class="details">
                                        Notification 1
                                    </div>
                                </a>
                            </li>
                            <li role="presentation">
                                <a href="#" class="support-ticket">
                                    <div class="picture">
                                        <span class="label label-warning"><i class="fa fa-question-circle"></i></span>
                                    </div>
                                    <div class="details">
                                        Notification 2
                                    </div>
                                </a>
                            </li>
                            <li role="presentation">
                                <a href="#" class="support-ticket">
                                    <div class="picture">
                                        <span class="label label-success"><i class="fa fa-tag"></i></span>
                                    </div>
                                    <div class="details">
                                        Notification 3
                                    </div>
                                </a>
                            </li>
                            <li role="presentation">
                                <a href="#" class="support-ticket">
                                    <div class="picture">
                                        <span class="label label-info"><i class="fa fa-info-circle"></i></span>
                                    </div>
                                    <div class="details">
                                        Notification 4
                                    </div>
                                </a>
                            </li>

                            <li role="presentation">
                                <a href="#" class="text-align-center see-all">
                                    See all tickets <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="hidden-xs dropdown">
                        <a href="#" title="Account" id="account" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="glyphicon glyphicon-user"></i>
                        </a>
                        <ul id="account-menu" class="dropdown-menu account" role="menu">
                            <li role="presentation" class="account-picture">
                                <img src="img/2.png" alt="">
                                Danh Trí Hiếu
                            </li>
                            <li role="presentation">
                                <a href="form_account.html" class="link">
                                    <i class="fa fa-user"></i>
                                    Profile
                                </a>
                            </li>

                        </ul>
                    </li>
                    <li class="hidden-xs"><a href="login.html"><i class="glyphicon glyphicon-off"></i></a></li>
                </ul>
            </div>
            <div>
                <h2 class="page-title">Information </h2>
            </div>
        </ul>
    </div>
    <nav id="mySidebar" class="sidebar">
        <button id="btnSidebar" onclick="openNav(this)">☰</button>
        <a href="info.html">View information</a>
        <a href="managersensor.html">Add/remove sensor</a>
        <a href="history.html">View history</a>
        <a href="control.html">Control device</a>
        <a href="report.html">Make report</a>
    </nav>
    <div id="content" class="content">
        <div class="data">
            <p>Temperature: </p>
            <label id="Temperature"></label>
        </div>
        <br>
        <div class="data">
            <p>Humid: </p>
            <label id="Humid"></label>
        </div>
        <br>
        <div class="data">
            <p>Light: </p>
            <label id="Light"></label>
        </div>
        <br>
        <div class="data">
            <p>Speaker: </p>
            <label id="Speaker"></label>
        </div>
        <br>
        <div class="slidecontainer">
            <input type="range" min="0" max="5000" value="0" class="slider" id="myRange" onchange="fun(this.value)">
            <input type="number" min="0" max="5000" class="inp_num" id="inp_number" onchange="fun(this.value)"> 
        </div>
        <script>
            var slider = document.getElementById("myRange");
            var output = document.getElementById("Speaker");
            var inpnum = document.getElementById("inp_number");
            output.innerHTML = slider.value;
            slider.oninput = function () {
                output.innerHTML = this.value;
                inpnum.value = this.value;
            }
            inpnum.oninput = function () {
                output.innerHTML = this.value;
                slider.value = this.value;
            }
            async function fun(value) {
                if (parseInt(value)>=5000) {value = "5000";}
                await fetch("http://localhost:3000/apicall/speaker", {
                    method: 'POST', // *GET, POST, PUT, DELETE, etc.
                    mode: 'cors', // no-cors, *cors, same-origin
                    cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                    credentials: 'same-origin', // include, *same-origin, omit
                    headers: {
                        'Content-Type': 'application/json'
                        // 'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    redirect: 'follow', // manual, *follow, error
                    referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                    body: JSON.stringify([{ "device_id": "Speaker", "values": ["1", value] }]) // body data type must match "Content-Type" header
                });
            }
        </script>

        <div class="row">
            <script>
                async function test() {
                    while (true) {
                        var temp, humid, light, speak = 0;

                        await fetch("http://localhost:3000/apicall/temphumi/latest")
                            .then((res) => res.json())
                            .then(data => {
                                console.log(data); // JSON object
                                temp = data["0"].values[0];
                                humid = data["0"].values[1];
                                document.getElementById('Temperature').innerHTML = data["0"].values[0];
                                document.getElementById('Humid').innerHTML = data["0"].values[1] + "%";
                            })
                            .catch(err => {
                                console.log(err);
                            })

                        await fetch("http://localhost:3000/apicall/light/latest")
                            .then((res) => res.json())
                            .then(data => {
                                console.log(data); // JSON object
                                light = data["0"].values;
                                document.getElementById('Light').innerHTML = data["0"].values + "lux";
                            })
                            .catch(err => {
                                console.log(err);
                            })
                        await fetch("http://localhost:3000/apicall/getspeaker")
                            .then((res) => res.json())
                            .then(data => {
                                console.log(data); // JSON object
                                speak = data["0"].values[1];
                                document.getElementById('Speaker').innerHTML = data["0"].values[1];
                            })
                            .catch(err => {
                                console.log(err);
                            })

                        val = document.getElementById("myRange").value;
                        if (parseInt(speak) <= 1000 && parseInt(temp) >= 70) {
                            await fetch("http://localhost:3000/apicall/speaker", {
                                method: 'POST', // *GET, POST, PUT, DELETE, etc.
                                mode: 'cors', // no-cors, *cors, same-origin
                                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                                credentials: 'same-origin', // include, *same-origin, omit
                                headers: {
                                    'Content-Type': 'application/json'
                                    // 'Content-Type': 'application/x-www-form-urlencoded',
                                },
                                redirect: 'follow', // manual, *follow, error
                                referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                                body: JSON.stringify([{ "device_id": "Speaker", "values": ["1", "3000"] }]) // body data type must match "Content-Type" header
                            });
                        }
                    }
                }
                test();
            </script>
        </div>
    </div>

    <script>
        function openNav(obj) {
            if (obj.innerHTML == "☰") {
                document.getElementById("mySidebar").style.width = "230px";
                document.getElementById("content").style.marginLeft = "230px";
                obj.innerHTML = "☰ ";
                return;
            }
            if (obj.innerHTML == "☰ ") {
                document.getElementById("mySidebar").style.width = obj.style.width;
                document.getElementById("content").style.marginLeft = "40px";
                obj.innerHTML = "☰";
                return;
            }
        }
    </script>
</body>

</html>